{% comment %}
Vista de cards para móviles - diseño optimizado para pantallas pequeñas
{% endcomment %}

{% if page_obj.object_list %}
  <div class="text-muted small mb-3">
    <i class="fas fa-list-ul"></i> Total: {{ paginator.count }} caso{{ paginator.count|pluralize:"s" }}
  </div>

  {# CARDS PARA MÓVIL - Colores institucionales IST #}
  <div class="row row-cols-1 g-3">
    {% for a in page_obj.object_list %}
      <div class="col">
        <div class="card shadow-sm border-ist">
          <div class="card-body">
            {# Header del card: Código Accidente #}
            <div class="mb-3 pb-2 border-bottom border-ist">
              <small class="text-muted d-block mb-1">
                <i class="fas fa-barcode text-ist"></i> <strong>Código Accidente</strong>
              </small>
              <h6 class="mb-0 text-ist fw-bold">
                {{ a.codigo_accidente_db|default:a.codigo_accidente|default:"Sin código" }}
              </h6>
            </div>

            {# Información principal #}
            <div class="mb-2">
              <small class="text-muted d-block">
                <i class="fas fa-user text-ist"></i> <strong>Trabajador:</strong>
              </small>
              <div class="ps-3">{{ a.trabajador.nombre_trabajador|default:"—" }}</div>
            </div>

            <div class="mb-2">
              <small class="text-muted d-block">
                <i class="fas fa-calendar-alt text-ist"></i> <strong>Fecha:</strong>
              </small>
              <div class="ps-3">
                {% if a.fecha_accidente %}
                  <time datetime="{{ a.fecha_accidente|date:'Y-m-d' }}">{{ a.fecha_accidente|date:"d/m/Y" }}</time>
                {% else %}—{% endif %}
              </div>
            </div>

            <div class="mb-2">
              <small class="text-muted d-block">
                <i class="fas fa-building text-ist"></i> <strong>Empresa:</strong>
              </small>
              <div class="ps-3">{{ a.empresa.empresa_sel|default:"—" }}</div>
            </div>

            <div class="mb-2">
              <small class="text-muted d-block">
                <i class="fas fa-map-marker-alt text-ist"></i> <strong>Centro:</strong>
              </small>
              <div class="ps-3">{{ a.centro.nombre_local|default:"—" }}</div>
            </div>

            <div class="mb-2">
              <small class="text-muted d-block">
                <i class="fas fa-user-tie text-ist"></i> <strong>Asignado(a):</strong>
              </small>
              <div class="ps-3">
                {% with u=a.usuario_asignado %}
                  {% if u %}
                    {% if u.first_name or u.last_name %}
                      {{ u.first_name }}{% if u.last_name %} {{ u.last_name }}{% endif %}
                    {% elif u.nombre %}
                      {{ u.nombre }}{% if u.apepat %} {{ u.apepat }}{% endif %}{% if u.apemat %} {{ u.apemat }}{% endif %}
                    {% else %}—{% endif %}
                  {% else %}—{% endif %}
                {% endwith %}
              </div>
            </div>

            {% if a.tipo_accidente %}
              <div class="mb-2">
                <small class="text-muted d-block">
                  <i class="fas fa-exclamation-triangle text-ist"></i> <strong>Tipo:</strong>
                </small>
                <div class="ps-3">
                  <span class="chip chip--violet">{{ a.tipo_accidente }}</span>
                </div>
              </div>
            {% endif %}

            {% if a.naturaleza_lesion %}
              <div class="mb-3">
                <small class="text-muted d-block">
                  <i class="fas fa-notes-medical text-ist"></i> <strong>Lesión:</strong>
                </small>
                <div class="ps-3">
                  <span class="chip chip--pink">{{ a.naturaleza_lesion }}</span>
                </div>
              </div>
            {% endif %}

            {# Botón de acción con estilo IST #}
            <div class="d-grid">
              {% url 'accidentes:empresa' a.codigo_accidente as det_url %}
              <a href="{{ det_url }}" class="btn btn-ist btn-sm">
                <i class="fas fa-folder-open"></i> Abrir Accidente
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  {# PAGINACIÓN PARA MÓVIL #}
  {% if paginator.num_pages > 1 %}
    <nav aria-label="Paginación de casos" class="mt-4">
      <div class="d-flex justify-content-between align-items-center gap-2">
        {% if prev_url %}
          <button class="btn btn-outline-primary btn-sm"
                  hx-get="{{ prev_url }}" 
                  hx-target="#results" 
                  hx-push-url="false">
            <i class="fas fa-chevron-left"></i> Anterior
          </button>
        {% else %}
          <button class="btn btn-outline-secondary btn-sm" disabled>
            <i class="fas fa-chevron-left"></i> Anterior
          </button>
        {% endif %}

        <span class="text-muted small">{{ page_obj.number }} / {{ paginator.num_pages }}</span>

        {% if next_url %}
          <button class="btn btn-outline-primary btn-sm"
                  hx-get="{{ next_url }}" 
                  hx-target="#results" 
                  hx-push-url="false">
            Siguiente <i class="fas fa-chevron-right"></i>
          </button>
        {% else %}
          <button class="btn btn-outline-secondary btn-sm" disabled>
            Siguiente <i class="fas fa-chevron-right"></i>
          </button>
        {% endif %}
      </div>
    </nav>
  {% endif %}

{% else %}
  <div class="text-center mt-4">
    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
    <p class="text-muted">No tienes casos asignados.</p>
  </div>
{% endif %}
